<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³ä¹æœç´¢</title>
    <style>
        /* æ›´æ–°é…è‰²æ–¹æ¡ˆ */
        :root {
            /* ä¸»è‰²è°ƒ */
            --primary-color: #60A5FA;    /* æµ…è“è‰² */
            --secondary-color: #38BDF8;  /* å¤©è“è‰² */
            --accent-color: #818CF8;     /* é›è“è‰² */
            
            /* èƒŒæ™¯è‰² - è°ƒæ•´é€æ˜åº¦ */
            --surface-color-90: rgba(31, 41, 55, 0.7);  /* é™ä½20%é€æ˜åº¦ */
            --surface-color-80: rgba(31, 41, 55, 0.6);
            --surface-color-70: rgba(31, 41, 55, 0.5);
            --surface-color-60: rgba(31, 41, 55, 0.4);
            
            /* ç»ç’ƒç‰¹æ•ˆ - å¢åŠ é€æ˜åº¦ */
            --glass-effect-strong: rgba(255, 255, 255, 0.15);
            --glass-effect-medium: rgba(255, 255, 255, 0.12);
            --glass-effect-light: rgba(255, 255, 255, 0.08);
            
            /* æ–‡å­—é¢œè‰² */
            --text-primary: #FFFFFF;      /* ä¸»è¦æ–‡å­— */
            --text-secondary: #E2E8F0;    /* æ¬¡è¦æ–‡å­— */
            
            /* æ¸å˜è‰² */
            --accent-gradient: linear-gradient(135deg, #60A5FA, #38BDF8);  /* æµ…è“æ¸å˜ */
            --hover-gradient: linear-gradient(135deg, #3B82F6, #0EA5E9);   /* æ·±è“æ¸å˜ */
            --card-gradient: linear-gradient(145deg, 
                rgba(31, 41, 55, 0.95) 0%,
                rgba(31, 41, 55, 0.85) 100%);
            
            /* ç‰¹æ•ˆ */
            --glass-effect: rgba(255, 255, 255, 0.08);
            --blur-strength: 20px;
            --glow-color: rgba(99, 102, 241, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: url('https://bing.img.run/rand.php') center/cover fixed no-repeat;
            backdrop-filter: blur(10px) brightness(1.1);  /* å¢åŠ äº®åº¦ */
            position: relative;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: var(--text-primary);
        }

        body::before {
            display: none;
        }

        .main-container {
            flex: 1;
            padding: 40px;
            max-width: calc(100% - 300px);
            margin-left: 300px;
            min-height: 100vh;
            padding-bottom: 120px;
            padding-top: 20px;
            background: var(--surface-color-80);
            backdrop-filter: blur(16px) brightness(1.05);
        }

        .search-container {
            background: var(--surface-color-90);
            border: 1px solid rgba(96, 165, 250, 0.2);  /* ä½¿ç”¨æµ…è“è‰²è¾¹æ¡† */
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1),
                       0 0 0 1px rgba(96, 165, 250, 0.1);
            backdrop-filter: blur(16px);
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            align-items: center;
            margin-top: 20px;
        }

        .quality-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-shrink: 0;
        }

        .quality-btn {
            padding: 10px 20px;
            border-radius: 12px;
            background: var(--glass-effect-light);
            color: var(--text-secondary);
            border: 1px solid rgba(96, 165, 250, 0.2);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 14px;
            backdrop-filter: blur(8px);
            font-size: 15px;
            font-weight: 500;
            letter-spacing: 0.3px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            height: 36px;
            display: flex;
            align-items: center;
            font-weight: 500;
            letter-spacing: 0.5px;
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .quality-btn.active {
            background: var(--accent-gradient);
            box-shadow: 0 4px 15px rgba(96, 165, 250, 0.4);
            border: none;
            color: var(--text-primary);
        }

        .search-box {
            flex: 1;
            margin: 0;
            display: flex;
            gap: 10px;
            align-items: center;
            background: var(--glass-effect-medium);
            border-radius: 16px;
            padding: 6px;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(96, 165, 250, 0.2);
            min-width: 200px;
        }

        input {
            flex: 1;
            padding: 8px 20px;
            height: 36px;
            border: none;
            background: transparent;
            color: white;
            font-size: 16px;
            letter-spacing: 0.3px;
        }

        input:focus {
            outline: none;
        }

        .search-btn {
            padding: 8px 20px;
            height: 36px;
            border-radius: 12px;
            border: none;
            background: var(--accent-gradient);
            color: white;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(96, 165, 250, 0.3);
        }

        .search-btn::before {
            content: 'ğŸ”';
            font-size: 16px;
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(96, 165, 250, 0.4);
        }

        .results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }

        .song-card {
            display: flex;
            flex-direction: column;
            gap: 12px;
            background: var(--surface-color-70);
            backdrop-filter: blur(12px);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(96, 165, 250, 0.15);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .song-card:hover {
            border-color: rgba(96, 165, 250, 0.3);
            box-shadow: 0 8px 30px rgba(96, 165, 250, 0.2);
            transform: translateY(-4px);
            background: var(--surface-color-80);
        }

        .song-info {
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex: 1;
        }

        .song-name {
            font-size: 17px;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            line-height: 1.4;
        }

        .singer-name {
            font-size: 14px;
            color: var(--text-secondary);
            opacity: 0.9;
            line-height: 1.4;
        }

        .song-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid rgba(96, 165, 250, 0.08);
            opacity: 1;
            transform: none;
        }

        .song-card:hover .song-controls {
            opacity: 1;
            transform: none;
        }

        .play-btn {
            flex: 1;
            padding: 10px 20px;
            border-radius: 12px;
            background: var(--glass-effect-strong);
            backdrop-filter: blur(8px);
            color: var(--text-primary);
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(96, 165, 250, 0.3);
        }

        .play-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(96, 165, 250, 0.4);
            background: var(--hover-gradient);
        }

        .download-btn {
            padding: 10px 20px;
            border-radius: 12px;
            background: var(--glass-effect-light);
            backdrop-filter: blur(8px);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .download-btn:hover {
            background: rgba(255, 255, 255, 0.18);
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .play-btn i, .download-btn i {
            font-size: 16px;
        }

        /* æ’­æ”¾å™¨æ ·å¼ */
        .player-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--surface-color-90);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(96, 165, 250, 0.2);
            padding: 20px 0;
            z-index: 1000;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.2);
        }

        .player-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 32px;
            align-items: center;
            padding: 0 30px;
        }

        .player-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 180px;
        }

        .now-playing {
            font-size: 10px;
            color: var(--secondary-color);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 2px;
            font-weight: 600;
            letter-spacing: 1.5px;
            opacity: 0.9;
        }

        .song-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1px;
            letter-spacing: 0.3px;
        }

        .song-artist {
            font-size: 13px;
            color: var(--text-secondary);
            letter-spacing: 0.2px;
        }

        .control-buttons {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 24px;
            margin-bottom: 12px;
        }

        .control-button {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            position: relative;
        }

        .control-button:hover {
            color: var(--text-primary);
            background: var(--glass-effect-medium);
            transform: scale(1.1);
        }

        #playPauseBtn {
            font-size: 28px;
            width: 42px;
            height: 42px;
            background: var(--accent-gradient);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            line-height: 1;
        }

        #playPauseBtn[data-state="playing"] {
            padding-left: 2px;
        }

        #playPauseBtn[data-state="paused"] {
            padding-left: 4px;
        }

        #playPauseBtn:hover {
            transform: scale(1.15);
            box-shadow: 0 0 20px rgba(96, 165, 250, 0.4);
        }

        .progress-container {
            width: 100%;
            padding: 0 2px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--glass-effect-light);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
            margin-bottom: 8px;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: var(--accent-gradient);
            border-radius: 3px;
            position: relative;
            transition: width 0.1s linear;
            box-shadow: 0 0 10px rgba(96, 165, 250, 0.4);
        }

        .progress::after {
            content: '';
            position: absolute;
            right: -4px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(96, 165, 250, 0.6);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .progress-bar:hover .progress::after {
            opacity: 1;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 140px;
            position: relative;
        }

        .volume-slider-container {
            position: relative;
            width: 80px;
            height: 4px;
            background: var(--glass-effect-light);
            border-radius: 2px;
            cursor: pointer;
        }

        .volume-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            background: transparent;
            outline: none;
            margin: 0;
            padding: 0;
            cursor: pointer;
            position: relative;
            z-index: 2;
        }

        .volume-slider-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 100%;
            background: var(--accent-gradient);
            border-radius: 2px;
            pointer-events: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 0 10px rgba(96, 165, 250, 0.4);
            position: relative;
            z-index: 3;
        }

        .volume-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(96, 165, 250, 0.4);
        }

        .volume-button {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }

        .volume-button:hover {
            color: var(--text-primary);
            background: var(--glass-effect-medium);
        }

        .volume-button.muted {
            color: var(--text-secondary);
            opacity: 0.5;
        }

        .volume-button.active {
            animation: volumePulse 0.3s ease;
        }

        .loading {
            text-align: center;
            padding: 24px;
            color: var(--text-secondary);
            display: none;
            font-size: 15px;
            letter-spacing: 0.3px;
            background: var(--glass-effect-medium);
            backdrop-filter: blur(8px);
        }

        .error-message {
            text-align: center;
            padding: 16px 24px;
            background: rgba(239, 68, 68, 0.2);
            backdrop-filter: blur(8px);
            border-radius: 12px;
            color: #FF3B30;
            margin: 20px 0;
            display: none;
            border: 1px solid rgba(239, 68, 68, 0.2);
            font-size: 15px;
            letter-spacing: 0.3px;
        }

        /* éŸ³é‡å›¾æ ‡åŠ¨ç”» */
        @keyframes volumePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* æ­Œå•æ ·å¼ */
        .playlist-container {
            background: linear-gradient(145deg, 
                rgba(30, 41, 59, 0.95) 0%,
                rgba(30, 41, 59, 0.9) 100%);
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .playlist-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .playlist-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .playlist-controls {
            display: flex;
            gap: 12px;
        }

        .playlist-btn {
            padding: 8px 16px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .playlist-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
        }

        .playlist-items {
            display: grid;
            gap: 8px;
        }

        .playlist-item {
            display: flex;
            align-items: center;
            padding: 16px;
            background: var(--glass-effect-light);
            backdrop-filter: blur(8px);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: 1px solid transparent;
        }

        .playlist-item:hover {
            background: var(--glass-effect-medium);
            border-color: rgba(96, 165, 250, 0.3);
            transform: translateX(8px);
        }

        .playlist-item.active {
            background: var(--glass-effect-strong);
            border-color: rgba(96, 165, 250, 0.4);
        }

        .playlist-item-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .playlist-item-title {
            font-size: 15px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .playlist-item-artist {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .playlist-item-controls {
            display: flex;
            gap: 8px;
            opacity: 0.6;
            transition: opacity 0.3s ease;
            position: absolute;
            right: 12px;
        }

        .playlist-item:hover .playlist-item-controls {
            opacity: 1;
        }

        .playlist-item-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .playlist-item-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        /* æ·»åŠ ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 300px;
            background: var(--surface-color-90);
            border-right: 1px solid rgba(96, 165, 250, 0.2);
            padding: 20px;
            overflow-y: auto;
            z-index: 100;
            backdrop-filter: blur(16px);
        }

        /* ä¿®æ”¹ä¸»å®¹å™¨æ ·å¼ */
        .main-container {
            flex: 1;
            padding: 40px;
            max-width: calc(100% - 300px);
            margin-left: 300px;
            min-height: 100vh;
            padding-bottom: 120px;
        }

        /* ä¿®æ”¹ä¾§è¾¹æ æ ‡é¢˜æ ·å¼ */
        .playlist-header {
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .playlist-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
        }

        /* ä¿®æ”¹ç§»åŠ¨ç«¯æ ·å¼ */
        @media screen and (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                width: 280px;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 1000;
                background: var(--surface-color-80);
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            /* ä¸»å®¹å™¨æ ·å¼ */
            .main-container {
                margin-left: 0;
                padding: 20px;
                max-width: 100%;
                padding-bottom: 120px;
            }

            /* æœç´¢å®¹å™¨æ ·å¼ */
            .search-container {
                padding: 16px;
                flex-direction: column;
                align-items: stretch;
            }

            .quality-selector {
                justify-content: center;
                margin-bottom: 12px;
            }

            .search-box {
                flex-direction: row;
                width: 100%;
            }

            /* æœç´¢ç»“æœæ ·å¼ */
            .results {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            /* æ’­æ”¾å™¨æ ·å¼ */
            .player-container {
                padding: 12px 0;
            }

            .player-content {
                grid-template-columns: 1fr;
                gap: 16px;
                padding: 0 16px;
                text-align: center;
            }

            .player-info {
                order: -1;
                min-width: unset;
                align-items: center;
            }

            .control-buttons {
                justify-content: center;
                gap: 20px;
            }

            .player-right-controls {
                justify-content: center;
                gap: 16px;
            }

            .progress-container {
                margin: 8px 0;
            }

            /* éŸ³é‡æ§åˆ¶æ ·å¼ */
            .volume-control {
                width: 100%;
                max-width: 200px;
                margin: 0 auto;
            }

            /* æ­Œå•é¡¹ç›®æ ·å¼ */
            .playlist-item {
                padding: 12px;
            }

            .playlist-item-controls {
                opacity: 1;
            }

            /* ä¾§è¾¹æ åˆ‡æ¢æŒ‰é’® */
            .sidebar-toggle {
                position: fixed;
                left: 16px;
                top: 16px;
                z-index: 1001;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: var(--surface-color-80);
                border: none;
                color: var(--text-primary);
                font-size: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            }
        }

        /* æ·»åŠ å®‰å…¨åŒºåŸŸé€‚é… */
        @supports (padding: env(safe-area-inset-bottom)) {
            @media screen and (max-width: 768px) {
                .player-container {
                    padding-bottom: calc(12px + env(safe-area-inset-bottom));
                }

                .main-container {
                    padding-top: calc(60px + env(safe-area-inset-top));
                    padding-bottom: calc(120px + env(safe-area-inset-bottom));
                }
            }
        }

        /* ä¼˜åŒ–ç§»åŠ¨ç«¯è§¦æ‘¸ä½“éªŒ */
        @media (hover: none) {
            .song-card:hover {
                transform: none;
            }

            .playlist-item:hover {
                transform: none;
            }

            .quality-btn:active,
            .search-btn:active,
            .playlist-item:active {
                opacity: 0.7;
            }
        }

        /* ä¿®å¤æ·»åŠ æ­Œå•æŒ‰é’®æ ·å¼ */
        .add-to-playlist-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            backdrop-filter: blur(8px);
        }

        .add-to-playlist-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            color: var(--text-primary);
            border-color: rgba(96, 165, 250, 0.3);
        }

        .add-to-playlist-btn span:last-child {
            font-size: 16px;
            font-weight: 600;
        }

        /* ä¿®å¤ä¸»å®¹å™¨é¡¶éƒ¨é—´è· */
        .main-container {
            padding-top: 20px;
            background: linear-gradient(180deg, 
                var(--surface-color-80) 0%,
                rgba(15, 23, 42, 0.95) 100%);
        }

        /* ä¿®å¤æœç´¢å®¹å™¨æ ·å¼ */
        .search-container {
            margin-top: 20px;
            background: linear-gradient(180deg, 
                rgba(30, 41, 59, 0.98) 0%,
                rgba(30, 41, 59, 0.95) 100%);
        }

        /* ä¿®å¤æ’­æ”¾å™¨å³ä¾§æ§æ ·å¼ */
        .player-right-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        /* ä¿®å¤ç§»åŠ¨ç«¯æ ·å¼ */
        @media screen and (max-width: 768px) {
            .main-container {
                padding-top: 60px;
            }
            
            .player-right-controls {
                flex-direction: column;
                align-items: center;
                gap: 12px;
            }
            
            .add-to-playlist-btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* é»˜è®¤éšè—ä¾§è¾¹æ åˆ‡æ¢æŒ‰é’® */
        .sidebar-toggle {
            display: none;  /* é»˜è®¤éšè— */
            position: fixed;
            left: 16px;
            top: 16px;
            z-index: 1001;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--surface-color-80);
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        /* åœ¨ç§»åŠ¨ç«¯æ‰æ˜¾ç¤ºä¾§è¾¹æ åˆ‡æ¢æŒ‰é’® */
        @media screen and (max-width: 768px) {
            .sidebar-toggle {
                display: flex;  /* ç§»åŠ¨ç«¯æ˜¾ç¤º */
            }
        }

        /* ä¾§è¾¹æ é®ç½©å±‚æ ·å¼ */
        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            z-index: 999;
            backdrop-filter: blur(8px);
        }

        /* ç§»åŠ¨ç«¯ä¾§è¾¹æ é®ç½©å±‚æ¿€æ´»çŠ¶æ€ */
        @media screen and (max-width: 768px) {
            .sidebar-overlay.active {
                display: block;
            }
        }

        /* ä¿®æ”¹æ’­æ”¾å™¨ä¸­çš„ä¸‹è½½æŒ‰é’®æ ·å¼ */
        .player-download-btn {
            padding: 8px 16px;
            border-radius: 12px;
            background: var(--glass-effect-light);
            backdrop-filter: blur(8px);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .player-download-btn:hover {
            background: var(--glass-effect-medium);
            transform: translateY(-2px);
            border-color: rgba(255, 255, 255, 0.2);
        }

        /* Toast æ¶ˆæ¯ç¾åŒ– */
        .toast {
            background: var(--surface-color-80);
            border: 1px solid rgba(96, 165, 250, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(12px);
        }
    </style>
</head>
<body>
    <button class="sidebar-toggle" onclick="toggleSidebar()">â˜°</button>
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
    <div class="sidebar">
        <div class="playlist-header">
            <div class="playlist-title">æˆ‘çš„æ­Œå•ï¼ˆBetaæµ‹è¯•ï¼‰</div>
            <div class="playlist-controls">
                <button class="playlist-btn" onclick="clearPlaylist()">æ¸…ç©ºæ­Œå•</button>
            </div>
        </div>
        <div class="playlist-items" id="playlistItems">
            <!-- æ­Œå•é¡¹ç›®å°†é€šè¿‡ JavaScript åŠ¨æ€æ·»åŠ  -->
        </div>
    </div>

    <div class="main-container">
        <div class="search-container">
            <div class="quality-selector">
                <button class="quality-btn active" data-br="1">æœ€é«˜éŸ³è´¨</button>
                <button class="quality-btn" data-br="2">HQé«˜å“MP3</button>
            </div>
            <div class="search-box">
                <input type="text" placeholder="è¾“å…¥æ­Œæ›²åæˆ–æ­Œæ‰‹åæœç´¢..." id="searchInput">
                <button class="search-btn" onclick="searchMusic()">æœç´¢</button>
            </div>
        </div>
        <div class="loading">æœç´¢ä¸­...</div>
        <div class="error-message" id="errorMessage"></div>
        <div class="results" id="results"></div>
    </div>

    <div class="player-container" id="playerContainer">
        <div class="player-content">
            <div class="player-info">
                <div class="song-details">
                    <div class="now-playing">æ­£åœ¨æ’­æ”¾</div>
                    <div class="song-title" id="playerTitle"></div>
                    <div class="song-artist" id="playerArtist"></div>
                </div>
            </div>
            <div class="player-controls">
                <div class="control-buttons">
                    <button class="control-button" onclick="previousTrack()">â®</button>
                    <button class="control-button" id="playPauseBtn" onclick="togglePlay()">â¸</button>
                    <button class="control-button" onclick="nextTrack()">â­</button>
                    <button class="control-button" onclick="toggleRepeat()">ğŸ”</button>
                </div>
                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar" id="progressBar"></div>
                    <div class="time-info">
                        <span id="currentTime">0:00</span>
                        <span id="duration">0:00</span>
                    </div>
                </div>
            </div>
            <div class="player-right-controls">
                <button class="add-to-playlist-btn" onclick="addCurrentToPlaylist()">
                    <span>æ·»åŠ åˆ°æ­Œå•</span>
                    <span>+</span>
                </button>
                <div class="volume-control">
                    <button class="volume-button" onclick="toggleMute()">ğŸ”Š</button>
                    <div class="volume-slider-container">
                        <div class="volume-slider-fill" id="volumeSliderFill"></div>
                        <input type="range" class="volume-slider" min="0" max="100" value="100" id="volumeSlider">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentAudio = null;
        let currentSongIndex = -1;
        let playlist = [];  // ä¸´æ—¶æ’­æ”¾åˆ—è¡¨
        let savedPlaylist = [];  // ä¿å­˜çš„æ­Œå•
        let isRepeat = false;
        let currentBr = "1"; // é»˜è®¤æœ€é«˜éŸ³è´¨
        const PLAYLIST_STORAGE_KEY = 'music_playlist';

        // é¦–å…ˆå®šä¹‰æ‰€æœ‰å·¥å…·å‡½æ•°
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function updatePlayerUI(song) {
            document.getElementById('playerTitle').textContent = song.title || song.name;
            document.getElementById('playerArtist').textContent = song.singer;
            document.getElementById('playerContainer').style.display = 'block';
        }

        function setupAudioPlayer(audio, song) {
            if (currentAudio) {
                currentAudio.pause();
            }
            currentAudio = audio;

            // æ›´æ–°æ’­æ”¾/æš‚åœæŒ‰é’®çŠ¶æ€
            const playPauseBtn = document.getElementById('playPauseBtn');
            playPauseBtn.textContent = 'â¸';
            playPauseBtn.setAttribute('data-state', 'playing');

            // æ—¶é—´æ›´æ–°äº‹ä»¶
            audio.addEventListener('timeupdate', () => {
                if (!audio.duration) return;
                const progress = (audio.currentTime / audio.duration) * 100;
                document.getElementById('progressBar').style.width = `${progress}%`;
                document.getElementById('currentTime').textContent = formatTime(audio.currentTime);
                document.getElementById('duration').textContent = formatTime(audio.duration);
            });

            // éŸ³æŸäº‹ä»¶
            audio.addEventListener('ended', () => {
                if (isRepeat) {
                    audio.currentTime = 0;
                    audio.play();
                } else {
                    nextTrack();
                }
            });

            // è¿›åº¦æ¡ç‚¹å‡»äº‹ä»¶
            document.getElementById('progressContainer').onclick = (e) => {
                const rect = e.target.getBoundingClientRect();
                const percent = (e.clientX - rect.left) / rect.width;
                if (audio.duration) {
                    audio.currentTime = percent * audio.duration;
                }
            };

            // éŸ³é‡æ§åˆ¶
            const volumeSlider = document.getElementById('volumeSlider');
            audio.volume = volumeSlider.value / 100;
            volumeSlider.oninput = (e) => {
                const value = e.target.value;
                audio.volume = value / 100;
                
                // æ›´æ–°å¡«å……æ¡å®½åº¦
                document.getElementById('volumeSliderFill').style.width = `${value}%`;
                
                // æ›´æ–°éŸ³é‡å›¾æ ‡
                const volumeBtn = document.querySelector('.volume-button');
                if (value == 0) {
                    volumeBtn.textContent = 'ğŸ”‡';
                    volumeBtn.classList.add('muted');
                } else if (value < 50) {
                    volumeBtn.textContent = 'ğŸ”‰';
                    volumeBtn.classList.remove('muted');
                } else {
                    volumeBtn.textContent = 'ğŸ”Š';
                    volumeBtn.classList.remove('muted');
                }
                
                // æ·»åŠ ç‚¹å‡»åé¦ˆ
                volumeBtn.classList.add('active');
                setTimeout(() => volumeBtn.classList.remove('active'), 300);
            };

            updatePlayerUI(song);

            // åœ¨æ’­æ”¾å™¨å³ä¾§æ§ä»¶ä¸­æ·»åŠ ä¸‹è½½æŒ‰é’®
            const playerRightControls = document.querySelector('.player-right-controls');
            const downloadBtn = document.createElement('button');
            downloadBtn.className = 'player-download-btn';
            downloadBtn.innerHTML = `
                <i class="fas fa-download"></i>
                <span>ä¸‹è½½å½“å‰æ­Œæ›²</span>
            `;
            downloadBtn.onclick = () => downloadSong(event, song.title, song.n);
            
            // ç¡®ä¿ä¸ä¼šé‡å¤æ·»åŠ ä¸‹è½½æŒ‰é’®
            const existingDownloadBtn = playerRightControls.querySelector('.player-download-btn');
            if (existingDownloadBtn) {
                existingDownloadBtn.remove();
            }
            playerRightControls.insertBefore(downloadBtn, playerRightControls.firstChild);
        }

        function togglePlay() {
            if (!currentAudio) return;
            
            const playPauseBtn = document.getElementById('playPauseBtn');
            if (currentAudio.paused) {
                currentAudio.play();
                playPauseBtn.textContent = 'â¸';
                playPauseBtn.setAttribute('data-state', 'playing');
            } else {
                currentAudio.pause();
                playPauseBtn.textContent = 'â–¶';
                playPauseBtn.setAttribute('data-state', 'paused');
            }
        }

        function toggleMute() {
            if (!currentAudio) return;
            
            const volumeBtn = document.querySelector('.volume-button');
            const volumeSlider = document.getElementById('volumeSlider');
            const volumeSliderFill = document.getElementById('volumeSliderFill');
            
            currentAudio.muted = !currentAudio.muted;
            if (currentAudio.muted) {
                volumeBtn.textContent = 'ğŸ”‡';
                volumeBtn.classList.add('muted');
                volumeSliderFill.style.width = '0%';
            } else {
                volumeBtn.textContent = currentAudio.volume < 0.5 ? 'ğŸ”‰' : 'ğŸ”Š';
                volumeBtn.classList.remove('muted');
                volumeSliderFill.style.width = `${currentAudio.volume * 100}%`;
            }
            
            volumeBtn.classList.add('active');
            setTimeout(() => volumeBtn.classList.remove('active'), 300);
        }

        function toggleRepeat() {
            isRepeat = !isRepeat;
            const repeatBtn = document.querySelector('[onclick="toggleRepeat()"]');
            repeatBtn.style.color = isRepeat ? '#ff9f43' : 'white';
        }

        function previousTrack() {
            if (currentSongIndex > 0 && playlist.length > 0) {
                currentSongIndex--;
                playTrack(playlist[currentSongIndex]);
            }
        }

        function nextTrack() {
            if (currentSongIndex < playlist.length - 1) {
                currentSongIndex++;
                playTrack(playlist[currentSongIndex]);
            }
        }

        async function playTrack(song) {
            if (currentAudio) {
                currentAudio.pause();
            }
            
            try {
                const playParams = new URLSearchParams({
                    gm: song.title,
                    n: song.n,
                    br: currentBr
                });

                const playResponse = await fetch(`https://www.hhlqilongzhu.cn/api/dg_wyymusic.php?${playParams}`);
                const playText = await playResponse.text();
                const playUrl = playText.split('\n').find(line => 
                    line.includes('æ’­æ”¾é“¾æ¥ï¼š') || line.includes('url:')
                );

                if (playUrl) {
                    let url;
                    if (playUrl.includes('æ’­æ”¾é“¾æ¥ï¼š')) {
                        url = playUrl.split('æ’­æ”¾é“¾æ¥ï¼š')[1].trim();
                    } else if (playUrl.includes('url:')) {
                        url = playUrl.split('url:')[1].trim();
                    }
                    
                    if (url && url.startsWith('http')) {
                        song.url = url;
                        const playlistIndex = savedPlaylist.findIndex(s => s.n === song.n);
                        if (playlistIndex !== -1) {
                            savedPlaylist[playlistIndex].url = url;
                            savePlaylist();
                        }
                        
                        const audio = new Audio(url);
                        setupAudioPlayer(audio, song);
                        audio.play();
                    } else {
                        throw new Error('Invalid URL');
                    }
                } else {
                    throw new Error('No play URL found');
                }
            } catch (error) {
                console.error('æ’­æ”¾å¤±è´¥:', error);
                showToast('æ’­æ”¾å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }

        // åˆå§‹åŒ–éŸ³è´¨é€‰æ‹©æŒ‰é’®
        const qualityBtns = document.querySelectorAll('.quality-btn');
        qualityBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                qualityBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentBr = btn.dataset.br;
            });
        });

        // æœç´¢åŠŸèƒ½
        async function searchMusic() {
            const searchInput = document.getElementById('searchInput').value.trim();
            if (!searchInput) return;

            const loadingDiv = document.querySelector('.loading');
            const errorDiv = document.getElementById('errorMessage');
            const resultsDiv = document.querySelector('.results');

            loadingDiv.style.display = 'block';
            errorDiv.style.display = 'none';
            resultsDiv.innerHTML = '';

            try {
                const searchParams = new URLSearchParams({
                    gm: searchInput,
                    type: 'json',
                    num: '30',
                    br: currentBr
                });

                const response = await fetch(`https://www.hhlqilongzhu.cn/api/dg_wyymusic.php?${searchParams}`);
                const data = await response.json();

                loadingDiv.style.display = 'none';

                if (data.code === 200 && data.data && data.data.length > 0) {
                    data.data.forEach(song => {
                        const card = document.createElement('div');
                        card.className = 'song-card';
                        card.innerHTML = `
                            <div class="song-info">
                                <div class="song-name">${song.title}</div>
                                <div class="singer-name">${song.singer}</div>
                            </div>
                            <div class="song-controls">
                                <button class="play-btn" onclick="playSong(event, ${JSON.stringify(song).replace(/"/g, '&quot;')})">
                                    <i class="fas fa-play"></i>
                                    æ’­æ”¾
                                </button>
                                <button class="download-btn" onclick="downloadSong(event, '${song.title}', '${song.n}')">
                                    <i class="fas fa-download"></i>
                                    ä¸‹è½½
                                </button>
                            </div>
                        `;
                        
                        card.onclick = null;
                        resultsDiv.appendChild(card);
                    });
                } else {
                    errorDiv.style.display = 'block';
                    errorDiv.textContent = data.msg || 'æœªæ‰¾åˆ°ç›¸å…³æ­Œæ›²ï¼Œè¯·æ¢ä¸ªå…³é”®è¯è¯•è¯•';
                }
            } catch (error) {
                loadingDiv.style.display = 'none';
                errorDiv.style.display = 'block';
                errorDiv.textContent = 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•';
                console.error('Error:', error);
            }
        }

        // ä¿®æ”¹ playSong å‡½æ•°
        async function playSong(event, song) {
            event.stopPropagation();
            try {
                const loadingDiv = document.querySelector('.loading');
                const errorDiv = document.getElementById('errorMessage');
                
                loadingDiv.style.display = 'block';
                errorDiv.style.display = 'none';

                const playParams = new URLSearchParams({
                    gm: song.title,
                    n: song.n,
                    br: currentBr
                });

                const playResponse = await fetch(`https://www.hhlqilongzhu.cn/api/dg_wyymusic.php?${playParams}`);
                const playText = await playResponse.text();

                loadingDiv.style.display = 'none';

                const playUrl = playText.split('\n').find(line => 
                    line.includes('æ’­æ”¾é“¾æ¥ï¼š') || line.includes('url:')
                );

                if (playUrl) {
                    let url;
                    if (playUrl.includes('æ’­æ”¾é“¾æ¥ï¼š')) {
                        url = playUrl.split('æ’­æ”¾é“¾æ¥ï¼š')[1].trim();
                    } else if (playUrl.includes('url:')) {
                        url = playUrl.split('url:')[1].trim();
                    }
                    
                    if (url && url.startsWith('http')) {
                        const audio = new Audio(url);
                        setupAudioPlayer(audio, song);
                        currentSongIndex = playlist.findIndex(s => s.n === song.n);
                        if (currentSongIndex === -1) {
                            playlist.push(song);
                            currentSongIndex = playlist.length - 1;
                        }
                        audio.play();
                    } else {
                        errorDiv.style.display = 'block';
                        errorDiv.textContent = 'æ— æ•ˆçš„æ’­æ”¾é“¾æ¥';
                        console.error('Invalid URL:', url);
                    }
                } else {
                    errorDiv.style.display = 'block';
                    errorDiv.textContent = 'æ— æ³•è·å–æ’­æ”¾é“¾æ¥';
                    console.error('Response text:', playText);
                }
            } catch (error) {
                const loadingDiv = document.querySelector('.loading');
                const errorDiv = document.getElementById('errorMessage');
                
                loadingDiv.style.display = 'none';
                errorDiv.style.display = 'block';
                errorDiv.textContent = 'è·å–æ’­æ”¾é“¾æ¥å¤±è´¥';
                console.error('Error:', error);
            }
        }

        // åŠ è½¦æœç´¢äº‹ä»¶ç›‘å¬
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchMusic();
            }
        });

        // æ­Œå•ç®¡ç†
        function loadSavedPlaylist() {
            const savedData = localStorage.getItem(PLAYLIST_STORAGE_KEY);
            if (savedData) {
                try {
                    savedPlaylist = JSON.parse(savedData);
                    renderPlaylist();
                } catch (error) {
                    console.error('Failed to load playlist:', error);
                    savedPlaylist = [];
                }
            }
        }

        function savePlaylist() {
            try {
                localStorage.setItem(PLAYLIST_STORAGE_KEY, JSON.stringify(savedPlaylist));
            } catch (error) {
                console.error('Failed to save playlist:', error);
                showToast('ä¿å­˜æ­Œå•å¤±è´¥');
            }
        }

        // æ·»åŠ æ­Œæ›²åˆ°æ­Œå•
        function addToPlaylist(song) {
            if (!savedPlaylist.some(item => item.n === song.n)) {
                const songWithUrl = {
                    ...song,
                    url: currentAudio ? currentAudio.src : null,
                    lastPlayed: Date.now()
                };
                savedPlaylist.push(songWithUrl);
                savePlaylist();
                renderPlaylist();
                showToast('å·²æ·»åŠ åˆ°æ­Œå•');
            } else {
                showToast('æ­Œæ›²å·²åœ¨æ­Œå•ä¸­');
            }
        }

        // ä»æ­Œå•ä¸­ç§»é™¤æ­Œæ›²
        function removeFromPlaylist(index) {
            savedPlaylist.splice(index, 1);
            savePlaylist();
            renderPlaylist();
            showToast('å·²ä»æ­Œå•ä¸­ç§»é™¤');
        }

        // æ¸…ç©ºæ­Œå•
        function clearPlaylist() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ­Œå•å—ï¼Ÿ')) {
                savedPlaylist = [];
                savePlaylist();
                renderPlaylist();
                showToast('æ­Œå•å·²æ¸…ç©º');
            }
        }

        // æ¸²æŸ“æ­Œå•
        function renderPlaylist() {
            const playlistContainer = document.getElementById('playlistItems');
            if (!playlistContainer) return;  // æ·»åŠ æ£€æŸ¥
            
            playlistContainer.innerHTML = '';
            
            savedPlaylist.forEach((song, index) => {
                // æ£€æŸ¥æ­Œæ›²å¯¹è±¡çš„å®Œæ•´æ€§
                if (!song || typeof song !== 'object') return;
                
                const title = song.title || song.name || 'æœªçŸ¥æ­Œæ›²';
                const artist = song.singer || song.artist || 'æœªçŸ¥æ­Œæ‰‹';
                
                const item = document.createElement('div');
                // æ£€æŸ¥å½“å‰æ’­æ”¾çš„æ­Œæ›²æ˜¯å¦æ˜¯è¿™é¦–æ­Œ
                const isPlaying = currentAudio && playlist[currentSongIndex] && 
                                playlist[currentSongIndex].n === song.n;
                item.className = `playlist-item${isPlaying ? ' active' : ''}`;
                
                item.onclick = (e) => {
                    // å¦‚æœç‚¹å‡»çš„æ˜¯æ§åˆ¶æŒ‰é’®ï¼Œä¸è§¦å‘æ’­æ”¾
                    if (e.target.closest('.playlist-item-controls')) {
                        return;
                    }
                    playFromPlaylist(index);
                };
                
                item.innerHTML = `
                    <div class="playlist-item-info">
                        <div class="playlist-item-title">${title}</div>
                        <div class="playlist-item-artist">${artist}</div>
                    </div>
                    <div class="playlist-item-controls">
                        <button class="playlist-item-btn" onclick="playFromPlaylist(${index})">â–¶ï¸</button>
                        <button class="playlist-item-btn" onclick="removeFromPlaylist(${index})">ğŸ—‘ï¸</button>
                    </div>
                `;
                playlistContainer.appendChild(item);
            });
        }

        // ä»æ­Œå•æ’­æ”¾
        async function playFromPlaylist(index) {
            const song = savedPlaylist[index];
            // æ›´æ–°æ’­æ”¾åˆ—è¡¨å’Œç´¢å¼•
            const playlistIndex = playlist.findIndex(s => s.n === song.n);
            if (playlistIndex === -1) {
                playlist.push(song);
                currentSongIndex = playlist.length - 1;
            } else {
                currentSongIndex = playlistIndex;
            }
            
            if (song.url) {
                const audio = new Audio(song.url);
                setupAudioPlayer(audio, song);
                audio.play();
                return;
            }
            
            try {
                // æ›´æ–°æ’­æ”¾åˆ—è¡¨å’Œç´¢å¼•
                const playlistIndex = playlist.findIndex(s => s.n === song.n);
                if (playlistIndex === -1) {
                    playlist.push(song);
                    currentSongIndex = playlist.length - 1;
                } else {
                    currentSongIndex = playlistIndex;
                }
                await playTrack(song);
            } catch (error) {
                console.error('æ’­æ”¾å¤±è´¥:', error);
                showToast('æ’­æ”¾å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
            renderPlaylist();
        }

        // æç¤ºæ¶ˆæ¯
        function showToast(message) {
            // å¦‚æœå·²æœ‰toastï¼Œå…ˆç§»é™¤
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 2000);
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–æ­Œå•
        function initializeApp() {
            loadSavedPlaylist();
            
            // æ·»åŠ æœç´¢ç›¸å…³çš„äº‹ä»¶å¬
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchMusic();
                }
            });
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initializeApp);

        // æ·»åŠ å½“å‰æ’­æ”¾æ­Œæ›²åˆ°æ­Œå•
        function addCurrentToPlaylist() {
            if (!currentAudio || currentSongIndex === -1) {
                showToast('å½“å‰æ²¡æœ‰æ­£åœ¨æ’­æ”¾çš„æ­Œæ›²');
                return;
            }
            
            const currentSong = playlist[currentSongIndex];
            
            // ç¡®ä¿æ­Œæ›²å¯¹è±¡å­˜åœ¨ä¸”åŒ…å«å¿…è¦å±æ€§
            if (!currentSong || !currentSong.n) {
                showToast('å½“å‰æ­Œæ›²ä¿¡æ¯ä¸å®Œæ•´');
                return;
            }
            
            const songWithUrl = {
                ...currentSong,
                url: currentAudio.src,
                lastPlayed: Date.now()
            };
            
            const existingIndex = savedPlaylist.findIndex(item => item.n === currentSong.n);
            if (existingIndex === -1) {
                savedPlaylist.push(songWithUrl);
                savePlaylist();
                renderPlaylist();
                showToast('å·²æ·»åŠ åˆ°æ­Œå•');
            } else {
                savedPlaylist[existingIndex] = songWithUrl;
                savePlaylist();
                showToast('æ­Œæ›²å·²åœ¨æ­Œå•ä¸­');
            }
        }

        // æ·»åŠ ä¾§è¾¹æ åˆ‡æ¢åŠŸèƒ½
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.sidebar-overlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
            
            // åˆ‡æ¢ä¾§è¾¹æ æ—¶ç¦ç”¨/å¯ç”¨bodyæ»šåŠ¨
            document.body.style.overflow = sidebar.classList.contains('active') ? 'hidden' : '';
        }

        // æ·»åŠ ç§»åŠ¨ç«¯è§¦æ‘¸æ»‘åŠ¨æ”¯æŒ
        let touchStartX = 0;
        let touchEndX = 0;

        document.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
        });

        document.addEventListener('touchmove', e => {
            touchEndX = e.touches[0].clientX;
        });

        document.addEventListener('touchend', () => {
            const sidebar = document.querySelector('.sidebar');
            const swipeDistance = touchEndX - touchStartX;
            
            // ä»å·¦å‘å³æ»‘åŠ¨æ‰“å¼€ä¾§è¾¹æ 
            if (swipeDistance > 50 && touchStartX < 30) {
                sidebar.classList.add('active');
                document.querySelector('.sidebar-overlay').classList.add('active');
                document.body.style.overflow = 'hidden';
            }
            
            // ä»å³å‘å·¦æ»‘åŠ¨å…³é—­ä¾§è¾¹æ 
            if (swipeDistance < -50 && sidebar.classList.contains('active')) {
                sidebar.classList.remove('active');
                document.querySelector('.sidebar-overlay').classList.remove('active');
                document.body.style.overflow = '';
            }
        });

        // ç›‘å¬å±å¹•æ–¹å‘å˜åŒ–
        window.addEventListener('orientationchange', () => {
            // é‡æ–°è®¡ç®—é«˜åº¦
            const vh = window.innerHeight * 0.01;
            document.documentElement.style.setProperty('--vh', `${vh}px`);
        });

        // æ·»åŠ ä¸‹è½½åŠŸèƒ½
        async function downloadSong(event, title, n) {
            event.stopPropagation(); // é˜»æ­¢è§¦å‘æ­Œæ›²æ’­æ”¾
            
            try {
                showToast('æ­£åœ¨è·å–ä¸‹è½½é“¾æ¥...');
                
                const playParams = new URLSearchParams({
                    gm: title,
                    n: n,
                    br: currentBr
                });

                const response = await fetch(`https://www.hhlqilongzhu.cn/api/dg_wyymusic.php?${playParams}`);
                const text = await response.text();
                const playUrl = text.split('\n').find(line => 
                    line.includes('æ’­æ”¾é“¾æ¥ï¼š') || line.includes('url:')
                );

                if (playUrl) {
                    let url;
                    if (playUrl.includes('æ’­æ”¾é“¾æ¥ï¼š')) {
                        url = playUrl.split('æ’­æ”¾é“¾æ¥ï¼š')[1].trim();
                    } else if (playUrl.includes('url:')) {
                        url = playUrl.split('url:')[1].trim();
                    }

                    if (url && url.startsWith('http')) {
                        // åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„ a æ ‡ç­¾æ¥è§¦å‘ä¸‹è½½
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `${title}.mp3`; // è®¾ç½®ä¸‹è½½æ–‡ä»¶å
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        
                        showToast('å¼€å§‹ä¸‹è½½...');
                    } else {
                        throw new Error('Invalid URL');
                    }
                } else {
                    throw new Error('No download URL found');
                }
            } catch (error) {
                console.error('ä¸‹è½½å¤±è´¥:', error);
                showToast('ä¸‹è½½å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }
    </script>
</body>
</html>